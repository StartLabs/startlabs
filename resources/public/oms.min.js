(function(){/*
 OverlappingMarkerSpiderfier
https://github.com/jawj/OverlappingMarkerSpiderfier-Leaflet
Copyright (c) 2011 - 2012 George MacKerron
Released under the MIT licence: http://opensource.org/licenses/mit-license
Note: The Leaflet maps API must be included *before* this code
*/
(function(){var n={}.hasOwnProperty,o=[].slice;if(null!=this.L){var l=function(b,c){var a,e,f,g,h=this;this.map=b;null==c&&(c={});for(a in c)n.call(c,a)&&(e=c[a],this[a]=e);this.initMarkerArrays();this.listeners={};g=["click","zoomend"];e=0;for(f=g.length;e<f;e++)a=g[e],this.map.addEventListener(a,function(){return h.unspiderfy()})},d,i;d=l.prototype;d.VERSION="0.2.5";i=2*Math.PI;d.keepSpiderfied=!1;d.nearbyDistance=20;d.circleSpiralSwitchover=9;d.circleFootSeparation=25;d.circleStartAngle=i/12;d.spiralFootSeparation=
28;d.spiralLengthStart=11;d.spiralLengthFactor=5;d.legWeight=1.5;d.legColors={usual:"#222",highlighted:"#f00"};d.initMarkerArrays=function(){this.markers=[];return this.markerListeners=[]};d.addMarker=function(b){var c,a=this;if(null!=b._oms)return this;b._oms=!0;c=function(){return a.spiderListener(b)};b.addEventListener("click",c);this.markerListeners.push(c);this.markers.push(b);return this};d.getMarkers=function(){return this.markers.slice(0)};d.removeMarker=function(b){var c,a;null!=b._omsData&&
this.unspiderfy();c=this.arrIndexOf(this.markers,b);if(0>c)return this;a=this.markerListeners.splice(c,1)[0];b.removeEventListener("click",a);delete b._oms;this.markers.splice(c,1);return this};d.clearMarkers=function(){var b,c,a,e,f;this.unspiderfy();f=this.markers;b=a=0;for(e=f.length;a<e;b=++a)c=f[b],b=this.markerListeners[b],c.removeEventListener("click",b),delete c._oms;this.initMarkerArrays();return this};d.addListener=function(b,c){var a,e;(null!=(e=(a=this.listeners)[b])?e:a[b]=[]).push(c);
return this};d.removeListener=function(b,c){var a;a=this.arrIndexOf(this.listeners[b],c);0>a||this.listeners[b].splice(a,1);return this};d.clearListeners=function(b){this.listeners[b]=[];return this};d.trigger=function(){var b,c,a,e,f,g;c=arguments[0];b=2<=arguments.length?o.call(arguments,1):[];c=null!=(a=this.listeners[c])?a:[];g=[];e=0;for(f=c.length;e<f;e++)a=c[e],g.push(a.apply(null,b));return g};d.generatePtsCircle=function(b,c){var a,e,f,g,h;f=this.circleFootSeparation*(2+b)/i;e=i/b;h=[];for(a=
g=0;0<=b?g<b:g>b;a=0<=b?++g:--g)a=this.circleStartAngle+a*e,h.push(new L.Point(c.x+f*Math.cos(a),c.y+f*Math.sin(a)));return h};d.generatePtsSpiral=function(b,c){var a,e,f,g,h;f=this.spiralLengthStart;a=0;h=[];for(e=g=0;0<=b?g<b:g>b;e=0<=b?++g:--g)a+=this.spiralFootSeparation/f+5E-4*e,e=new L.Point(c.x+f*Math.cos(a),c.y+f*Math.sin(a)),f+=i*this.spiralLengthFactor/a,h.push(e);return h};d.spiderListener=function(b){var c,a,e,f,g,h,d,j,k;c=null!=b._omsData;(!c||!this.keepSpiderfied)&&this.unspiderfy();
if(c)return this.trigger("click",b);f=[];g=[];h=this.nearbyDistance*this.nearbyDistance;e=this.map.latLngToLayerPoint(b.getLatLng());k=this.markers;d=0;for(j=k.length;d<j;d++)c=k[d],a=this.map.latLngToLayerPoint(c.getLatLng()),this.ptDistanceSq(a,e)<h?f.push({marker:c,markerPt:a}):g.push(c);return 1===f.length?this.trigger("click",b):this.spiderfy(f,g)};d.makeHighlightListeners=function(b){var c=this;return{highlight:function(){return b._omsData.leg.setStyle({color:c.legColors.highlighted})},unhighlight:function(){return b._omsData.leg.setStyle({color:c.legColors.usual})}}};
d.spiderfy=function(b,c){var a,e,f,g,d,m;this.spiderfying=!0;f=b.length;a=this.ptAverage(function(){var a,c,e;e=[];a=0;for(c=b.length;a<c;a++)m=b[a],e.push(m.markerPt);return e}());f=f>=this.circleSpiralSwitchover?this.generatePtsSpiral(f,a).reverse():this.generatePtsCircle(f,a);var j,k,i,l=this;i=[];j=0;for(k=f.length;j<k;j++)e=f[j],a=this.map.layerPointToLatLng(e),d=this.minExtract(b,function(a){return l.ptDistanceSq(a.markerPt,e)}),d=d.marker,g=new L.Polyline([d.getLatLng(),a],{color:this.legColors.usual,
weight:this.legWeight,clickable:!1}),this.map.addLayer(g),d._omsData={usualPosition:d.getLatLng(),leg:g},this.legColors.highlighted!==this.legColors.usual&&(g=this.makeHighlightListeners(d),d._omsData.highlightListeners=g,d.addEventListener("mouseover",g.highlight),d.addEventListener("mouseout",g.unhighlight)),d.setLatLng(a),d.setZIndexOffset(1E6),i.push(d);delete this.spiderfying;this.spiderfied=!0;return this.trigger("spiderfy",i,c)};d.unspiderfy=function(b){var c,a,e,f,d,h,i;null==b&&(b=null);
if(null==this.spiderfied)return this;this.unspiderfying=!0;f=[];e=[];i=this.markers;d=0;for(h=i.length;d<h;d++)c=i[d],null!=c._omsData?(this.map.removeLayer(c._omsData.leg),c!==b&&c.setLatLng(c._omsData.usualPosition),c.setZIndexOffset(0),a=c._omsData.highlightListeners,null!=a&&(c.removeEventListener("mouseover",a.highlight),c.removeEventListener("mouseout",a.unhighlight)),delete c._omsData,f.push(c)):e.push(c);delete this.unspiderfying;delete this.spiderfied;this.trigger("unspiderfy",f,e);return this};
d.ptDistanceSq=function(b,c){var a,e;a=b.x-c.x;e=b.y-c.y;return a*a+e*e};d.ptAverage=function(b){var c,a,e,d,g;d=a=e=0;for(g=b.length;d<g;d++)c=b[d],a+=c.x,e+=c.y;b=b.length;return new L.Point(a/b,e/b)};d.minExtract=function(b,c){var a,d,f,g,h,i;f=h=0;for(i=b.length;h<i;f=++h)if(g=b[f],g=c(g),!("undefined"!==typeof a&&null!==a)||g<d)d=g,a=f;return b.splice(a,1)[0]};d.arrIndexOf=function(b,c){var a,d,f,g;if(null!=b.indexOf)return b.indexOf(c);a=f=0;for(g=b.length;f<g;a=++f)if(d=b[a],d===c)return a;
return-1};this.OverlappingMarkerSpiderfier=l}}).call(this);}).call(this);
/* Sun Sep 9 06:04:06 EDT 2012 */
